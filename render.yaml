# render.yaml
#
# LEGACY: This file is no longer used for deployment.
# The backend has been migrated from Render.com to a self-hosted Raspberry Pi
# with a Cloudflare Tunnel (https://scribeapi.manitmishra.com).
# This file is kept for reference only.
#
# See docs/ARCHITECTURE.MD for current deployment details.
#
services:
  # ----------------- API -----------------
  - type: web
    name: scribe-api
    env: python
    plan: free
    buildCommand: ./build.sh
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT --timeout-keep-alive 180
    envVars:
      - fromGroup: scribe-backend

  # ---------------- Celery worker --------
  - type: worker
    name: scribe-celery
    env: python
    plan: free
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
    startCommand: celery -A celery_config.celery_app worker -Q email_default,celery --loglevel=info
    envVars:
      - fromGroup: scribe-backend