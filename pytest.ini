[pytest]
# ============================================================================
# Pytest Configuration for Scribe Email Generation Platform
# ============================================================================

# Test discovery paths
testpaths =
    pipeline
    api
    scripts

# Python files/directories to search for tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# ============================================================================
# Async Configuration
# ============================================================================
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# ============================================================================
# Output and Reporting
# ============================================================================

# More verbose output
addopts =
    # Show summary of all test outcomes
    -ra
    # Verbose output
    -v
    # Show local variables in tracebacks
    --showlocals
    # Strict markers (fail on unknown markers)
    --strict-markers
    # Strict config (fail on config errors)
    --strict-config
    # Capture method: fd (file descriptors) for better async support
    --capture=no
    # Disable warnings summary (too verbose)
    --disable-warnings

# Console output style
console_output_style = progress

# ============================================================================
# Markers
# ============================================================================
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests requiring external services (Supabase, APIs, etc.)
    unit: marks tests as unit tests (fast, no external dependencies)
    asyncio: marks async tests

# ============================================================================
# Warnings
# ============================================================================
filterwarnings =
    # Ignore specific warnings that are expected/harmless
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    # You can add specific warnings to catch:
    # error::UserWarning

# ============================================================================
# Coverage (when running with pytest-cov)
# ============================================================================
# Uncomment to enable coverage by default
# addopts = --cov=pipeline --cov=api --cov-report=html --cov-report=term

# ============================================================================
# Logging
# ============================================================================
# Log format
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# File logging (uncomment to enable)
# log_file = tests.log
# log_file_level = DEBUG
# log_file_format = %(asctime)s [%(levelname)s] %(name)s: %(message)s
# log_file_date_format = %Y-%m-%d %H:%M:%S

# ============================================================================
# Timeouts (requires pytest-timeout)
# ============================================================================
# Uncomment to set global timeout for all tests
# timeout = 300
# timeout_method = thread

# ============================================================================
# Minimum Python Version
# ============================================================================
minversion = 7.0
